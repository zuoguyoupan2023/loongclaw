# LoongClaw æ¶æ„æ–‡æ¡£

## ğŸ“– ç›®å½•

- [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
- [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
- [æ¨¡å—è¯¦è§£](#æ¨¡å—è¯¦è§£)
- [æ•°æ®æµ](#æ•°æ®æµ)
- [å®‰å…¨æœºåˆ¶](#å®‰å…¨æœºåˆ¶)
- [æ‰©å±•æœºåˆ¶](#æ‰©å±•æœºåˆ¶)

---

## ç³»ç»Ÿæ¦‚è¿°

### è®¾è®¡ç†å¿µ

LoongClaw éµå¾ª **"ç²¾ç®€ä½†åŠŸèƒ½å®Œæ•´"** çš„è®¾è®¡ç†å¿µï¼š

- **æ¨¡å—åŒ–**: æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
- **å¯æ’æ‹”**: ç»„ä»¶å¯ç‹¬ç«‹æ›¿æ¢å’Œæ‰©å±•
- **å­¦ä¹ å¯¼å‘**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œé€‚åˆå­¦ä¹  AI Agent ç³»ç»Ÿ
- **ç”Ÿäº§å¯ç”¨**: è™½ç„¶ç²¾ç®€ï¼Œä½†å…·å¤‡ç”Ÿäº§ç¯å¢ƒçš„åŸºç¡€èƒ½åŠ›

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·ç•Œé¢å±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  WebChat UI  â”‚  â”‚  REST API    â”‚  â”‚  WebSocket   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Agent å¼•æ“å±‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Agent (å¯¹è¯è°ƒåº¦ã€å·¥å…·è°ƒç”¨ã€è®°å¿†ç®¡ç†)          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¸å¿ƒæœåŠ¡å±‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LLM é€‚é…å™¨â”‚  â”‚ å·¥å…·ç®¡ç†å™¨â”‚  â”‚   è®°å¿†ç³»ç»Ÿ       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åŸºç¡€è®¾æ–½å±‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ HTTP/WS  â”‚  â”‚ æ–‡ä»¶ç³»ç»Ÿ â”‚  â”‚   ç¯å¢ƒé…ç½®       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒæ¶æ„

### 1. åˆ†å±‚è®¾è®¡

LoongClaw é‡‡ç”¨ç»å…¸çš„ **åˆ†å±‚æ¶æ„**ï¼š

#### è¡¨ç°å±‚ (Presentation Layer)
- **WebChat UI**: çº¯ HTML/CSS/JS å®ç°çš„èŠå¤©ç•Œé¢
- **REST API**: æä¾› HTTP æ¥å£ä¾›å¤–éƒ¨è°ƒç”¨
- **WebSocket**: æ”¯æŒå®æ—¶åŒå‘é€šä¿¡

#### ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)
- **Agent**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œåè°ƒå„æ¨¡å—
- **å·¥å…·ç®¡ç†**: ç®¡ç†å’Œæ‰§è¡Œå·¥å…·è°ƒç”¨
- **è®°å¿†ç®¡ç†**: çŸ­æœŸå’Œé•¿æœŸè®°å¿†çš„å­˜å‚¨ä¸æ£€ç´¢

#### æœåŠ¡å±‚ (Service Layer)
- **LLM é€‚é…å™¨**: å°è£… LLM API è°ƒç”¨
- **æ–‡ä»¶æœåŠ¡**: æ–‡ä»¶è¯»å†™æ“ä½œ
- **Shell æœåŠ¡**: å®‰å…¨çš„å‘½ä»¤æ‰§è¡Œ

#### æ•°æ®å±‚ (Data Layer)
- **æ–‡ä»¶ç³»ç»Ÿ**: JSON/Markdown å­˜å‚¨
- **å†…å­˜ç¼“å­˜**: çŸ­æœŸè®°å¿†å’Œä¼šè¯çŠ¶æ€

---

## æ¨¡å—è¯¦è§£

### Agent å¼•æ“

**æ–‡ä»¶**: `core/agent.js`

**èŒè´£**:
- å¯¹è¯æµç¨‹æ§åˆ¶
- å·¥å…·è°ƒç”¨å†³ç­–
- è®°å¿†ç®¡ç†
- ä¼šè¯ç®¡ç†

**æ ¸å¿ƒæ–¹æ³•**:

```javascript
class Agent {
  // å¤„ç†ç”¨æˆ·æ¶ˆæ¯
  async process(message, sessionId)
  
  // æµå¼å¤„ç†
  async processStream(message, onChunk, sessionId)
  
  // è·å–ä¼šè¯å†å²
  getHistory(sessionId)
  
  // æ¸…é™¤å†å²
  clearHistory(sessionId)
}
```

**å·¥ä½œæµç¨‹**:

```
ç”¨æˆ·æ¶ˆæ¯
  â†“
1. è·å–/åˆ›å»ºä¼šè¯
  â†“
2. æœç´¢ç›¸å…³è®°å¿†
  â†“
3. æ„å»º LLM ä¸Šä¸‹æ–‡
  â†“
4. è°ƒç”¨ LLM
  â†“
5. å¤„ç†å·¥å…·è°ƒç”¨ (å¦‚æœæœ‰)
  â†“
6. ä¿å­˜åˆ°è®°å¿†
  â†“
7. è¿”å›å“åº”
```

---

### LLM é€‚é…å™¨

**æ–‡ä»¶**: `core/llm.js`

**èŒè´£**:
- å°è£… LLM API è°ƒç”¨
- æ”¯æŒå¤šç§æ¨¡å‹ (GLM-4, DeepSeek, Kimi)
- æµå¼è¾“å‡ºå¤„ç†

**æ¥å£**:

```javascript
class LLMAdapter {
  // åŒæ­¥èŠå¤©
  async chat(messages, tools, options)
  
  // æµå¼èŠå¤©
  async chatStream(messages, onChunk, tools)
  
  // å¥åº·æ£€æŸ¥
  async healthCheck()
}
```

**æ”¯æŒæ¨¡å‹**:

| æ¨¡å‹ | æä¾›å•† | çŠ¶æ€ |
|------|--------|------|
| GLM-4 | æ™ºè°± AI | âœ… é»˜è®¤ |
| DeepSeek | DeepSeek | âš ï¸ å¯é€‰ |
| Kimi | Moonshot | âš ï¸ å¯é€‰ |

---

### å·¥å…·ç³»ç»Ÿ

**æ–‡ä»¶**: `core/tools.js`

**èŒè´£**:
- å·¥å…·æ³¨å†Œä¸ç®¡ç†
- å‚æ•°éªŒè¯
- å®‰å…¨æ‰§è¡Œ

**å·¥å…·æ¥å£**:

```javascript
class Tool {
  constructor(name, description, parameters, handler)
  
  // æ‰§è¡Œå·¥å…·
  async execute(args)
}

class ToolManager {
  // æ³¨å†Œå·¥å…·
  register(tool)
  
  // è°ƒç”¨å·¥å…·
  async call(name, args)
  
  // è®¾ç½®å®‰å…¨è·¯å¾„
  setAllowedPaths(paths)
}
```

**å†…ç½®å·¥å…·**:

| å·¥å…·å | åŠŸèƒ½ | å®‰å…¨æœºåˆ¶ |
|--------|------|----------|
| `read_file` | è¯»å–æ–‡ä»¶ | è·¯å¾„ç™½åå• |
| `write_file` | å†™å…¥æ–‡ä»¶ | è·¯å¾„ç™½åå• |
| `list_directory` | åˆ—å‡ºç›®å½• | è·¯å¾„ç™½åå• |
| `exec_shell` | Shell æ‰§è¡Œ | å‘½ä»¤ç™½åå• |
| `get_current_time` | è·å–æ—¶é—´ | æ— éœ€é™åˆ¶ |

---

### è®°å¿†ç³»ç»Ÿ

**æ–‡ä»¶**: `core/memory.js`

**èŒè´£**:
- çŸ­æœŸè®°å¿† (ä¼šè¯å†…)
- é•¿æœŸè®°å¿† (Markdown æŒä¹…åŒ–)
- è¯­ä¹‰æœç´¢

**è®°å¿†ç±»å‹**:

```javascript
const MemoryType = {
  FACT: 'fact',        // äº‹å®ä¿¡æ¯
  EVENT: 'event',      // äº‹ä»¶è®°å½•
  DECISION: 'decision', // å†³ç­–è®°å½•
  THOUGHT: 'thought'   // æ€è€ƒè®°å½•
};
```

**å­˜å‚¨æ ¼å¼**:

```markdown
## 2026-02-12T17:56:11.796Z
- **ç±»å‹**: event
- **é‡è¦æ€§**: high
- **æ ‡ç­¾**: conversation, color

Q: è®°ä½ï¼šæˆ‘æœ€å–œæ¬¢çš„é¢œè‰²æ˜¯è“è‰²
A: å¥½çš„ï¼Œæˆ‘å·²ç»è®°ä½äº†è¿™ä¸ªä¿¡æ¯ã€‚
```

**æ£€ç´¢æœºåˆ¶**:
- å…³é”®è¯åŒ¹é…
- æ ‡ç­¾è¿‡æ»¤
- æ—¶é—´èŒƒå›´
- é‡è¦æ€§æƒé‡

---

### Web æœåŠ¡å™¨

**æ–‡ä»¶**: `core/server.js`

**èŒè´£**:
- HTTP API æœåŠ¡
- WebSocket æœåŠ¡
- é™æ€æ–‡ä»¶æœåŠ¡

**REST API ç«¯ç‚¹**:

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/health` | GET | å¥åº·æ£€æŸ¥ |
| `/api/stats` | GET | ç»Ÿè®¡ä¿¡æ¯ |
| `/api/chat` | POST | å•æ¬¡å¯¹è¯ |
| `/api/history/:id?` | GET | è·å–å†å² |
| `/api/memory/search` | GET | æœç´¢è®°å¿† |
| `/api/memory/export` | GET | å¯¼å‡ºè®°å¿† |

**WebSocket äº‹ä»¶**:

| äº‹ä»¶ | æ–¹å‘ | è¯´æ˜ |
|------|------|------|
| `chat` | Câ†’S | å‘é€æ¶ˆæ¯ |
| `message_chunk` | Sâ†’C | æµå¼å“åº” |
| `message_complete` | Sâ†’C | å®Œæ•´å“åº” |
| `error` | Sâ†’C | é”™è¯¯é€šçŸ¥ |

---

## æ•°æ®æµ

### å¯¹è¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. WebChat UI / REST API / WS      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Agent.process(message)           â”‚
â”‚    - è·å–ä¼šè¯                       â”‚
â”‚    - æœç´¢è®°å¿†                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. LLM.chat(context, tools)        â”‚
â”‚    - æ„å»ºæ¶ˆæ¯åˆ—è¡¨                   â”‚
â”‚    - è°ƒç”¨ API                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
    æœ‰å·¥å…·è°ƒç”¨ï¼Ÿ
       â†“
      â”Œâ”€â”€Yesâ”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚         â”‚ ToolManager.call()   â”‚
      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â†“
      â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚         â”‚ å·¥å…·æ‰§è¡Œç»“æœ         â”‚
      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â†“
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ LLM.chat() (äºŒæ¬¡)   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ 4. Memory.add()     â”‚
                         â”‚    - ä¿å­˜é‡è¦è®°å¿†    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ 5. è¿”å›å“åº”          â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ UI æ¸²æŸ“ / API å“åº”   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥å…·è°ƒç”¨æµç¨‹

```
LLM å“åº”åŒ…å« tool_calls
  â†“
éå† tool_calls
  â†“
å¯¹äºæ¯ä¸ªå·¥å…·è°ƒç”¨:
  1. è§£æå·¥å…·åç§°å’Œå‚æ•°
  2. éªŒè¯å‚æ•° (required å­—æ®µ)
  3. æ‰§è¡Œå·¥å…· handler
  4. æ•è·ç»“æœ/é”™è¯¯
  5. æ„å»ºå·¥å…·å“åº”æ¶ˆæ¯
  â†“
åˆå¹¶æ‰€æœ‰å·¥å…·å“åº”
  â†“
å†æ¬¡è°ƒç”¨ LLM (åŒ…å«å·¥å…·ç»“æœ)
  â†“
è·å–æœ€ç»ˆå“åº”
```

---

## å®‰å…¨æœºåˆ¶

### 1. æ–‡ä»¶ç³»ç»Ÿè®¿é—®é™åˆ¶

**è·¯å¾„ç™½åå•**:

```javascript
const ALLOWED_PATHS = [
  './workspace',
  './memory',
  './sessions'
];
```

**éªŒè¯é€»è¾‘**:

```javascript
isPathAllowed(path) {
  const normalizedPath = path.replace(/\.\.\//g, '');
  return ALLOWED_PATHS.some(allowedPath => 
    normalizedPath.startsWith(allowedPath)
  );
}
```

**ç¦æ­¢æ“ä½œ**:
- âŒ è®¿é—®è·¯å¾„ç™½åå•å¤–çš„æ–‡ä»¶
- âŒ è·¯å¾„éå† (`../`)
- âŒ ç³»ç»Ÿå…³é”®è·¯å¾„ (`/etc`, `/root`, etc.)

### 2. Shell æ‰§è¡Œé™åˆ¶

**å‘½ä»¤ç™½åå•**:

```javascript
const SHELL_WHITELIST = [
  'ls', 'pwd', 'echo', 
  'cat', 'head', 'tail', 
  'grep', 'wc'
];
```

**å®‰å…¨æªæ–½**:
- å‘½ä»¤ç™½åå•éªŒè¯
- è¶…æ—¶æ§åˆ¶ (é»˜è®¤ 30 ç§’)
- èµ„æºé™åˆ¶

### 3. API è°ƒç”¨é™åˆ¶

**é™åˆ¶æªæ–½**:
- è¯·æ±‚è¶…æ—¶ (é»˜è®¤ 60 ç§’)
- é”™è¯¯é‡è¯•æœºåˆ¶
- Token ä½¿ç”¨ç›‘æ§

---

## æ‰©å±•æœºåˆ¶

### æ·»åŠ è‡ªå®šä¹‰å·¥å…·

```javascript
import { Tool, ToolManager } from './core/tools.js';

// åˆ›å»ºå·¥å…·
const myTool = new Tool({
  name: 'my_tool',
  description: 'æˆ‘çš„è‡ªå®šä¹‰å·¥å…·',
  parameters: {
    type: 'object',
    properties: {
      input: { type: 'string' }
    },
    required: ['input']
  },
  handler: async (args) => {
    // å·¥å…·é€»è¾‘
    return { result: `å¤„ç†: ${args.input}` };
  }
});

// æ³¨å†Œå·¥å…·
agent.tools.register(myTool);
```

### æ·»åŠ æ–°çš„ LLM æ”¯æŒ

```javascript
import { LLMAdapter } from './core/llm.js';

// åˆ›å»ºé€‚é…å™¨
class MyLLMAdapter extends LLMAdapter {
  async chat(messages, tools) {
    // è°ƒç”¨ä½ çš„ LLM API
    return response;
  }
}

// ä½¿ç”¨é€‚é…å™¨
const agent = new Agent({
  llm: {
    adapter: MyLLMAdapter,
    apiKey: 'your-key'
  }
});
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. è®°å¿†ç¼“å­˜

```javascript
// é•¿æœŸè®°å¿†ç¼“å­˜ (é¿å…é¢‘ç¹è¯»å–)
this.longTermCache = null;
```

### 2. è¿æ¥æ± 

```javascript
// HTTP è¿æ¥å¤ç”¨
this.client = axios.create({
  baseURL: this.apiUrl,
  timeout: this.timeout
});
```

### 3. æµå¼è¾“å‡º

```javascript
// åˆ†å—è¿”å›ï¼Œé™ä½é¦–å­—å»¶è¿Ÿ
await this.llm.chatStream(messages, onChunk);
```

---

## ç›‘æ§ä¸æ—¥å¿—

### å¥åº·æ£€æŸ¥

```javascript
// LLM å¥åº·æ£€æŸ¥
await this.llm.healthCheck();

// ç»Ÿè®¡ä¿¡æ¯
agent.getStats();
// {
//   sessions: 1,
//   tools: 5,
//   shortTermMemories: 10
// }
```

### æ—¥å¿—çº§åˆ«

```env
LOG_LEVEL=debug|info|warn|error
```

---

## éƒ¨ç½²æ¶æ„

### å•æœºéƒ¨ç½²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LoongClaw å®¹å™¨/è¿›ç¨‹        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Agent   â”‚  â”‚  Web Server  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                â†“
    [æ–‡ä»¶ç³»ç»Ÿ]       [HTTP/WS]
```

### Docker éƒ¨ç½² (æœªæ¥)

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install --production
COPY . .
EXPOSE 3000 3001
CMD ["npm", "start"]
```

---

## ä¸ OpenClaw å¯¹æ¯”

| ç‰¹æ€§ | OpenClaw | LoongClaw | è¯´æ˜ |
|------|----------|-----------|------|
| **æ¶æ„å¤æ‚åº¦** | â­â­â­â­â­ | â­â­â­ | LoongClaw æ›´ç®€æ´ |
| **ä»£ç é‡** | ~10K è¡Œ | ~2K è¡Œ | LoongClaw åªæœ‰ 20% |
| **é€šé“æ”¯æŒ** | 10+ | 1 (WebChat) | LoongClaw ä¸“æ³¨å•ä¸€é€šé“ |
| **æ¨¡å‹æ”¯æŒ** | 20+ | 3 | LoongClaw æ”¯æŒä¸»æµæ¨¡å‹ |
| **å·¥å…·æ•°é‡** | 50+ | 5 | LoongClaw åŒ…å«æ ¸å¿ƒå·¥å…· |
| **æ‰©å±•æ€§** | æŠ€èƒ½å¸‚åœº | æ‰‹åŠ¨æ³¨å†Œ | OpenClaw æ›´çµæ´» |
| **å­¦ä¹ æ›²çº¿** | é™¡å³­ | å¹³ç¼“ | LoongClaw æ˜“äºç†è§£ |

**æ ¸å¿ƒåŒºåˆ«**:
- OpenClaw: **ç”Ÿäº§çº§**ä¼ä¸šæ¡†æ¶
- LoongClaw: **å­¦ä¹ å¯¼å‘**å‚è€ƒå®ç°

---

## æ€»ç»“

LoongClaw çš„æ¶æ„è®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **ç®€æ´ä¼˜å…ˆ**: å»é™¤ä¸å¿…è¦çš„å¤æ‚æ€§
2. **æ¨¡å—åŒ–**: é«˜å†…èšã€ä½è€¦åˆ
3. **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½
4. **å®‰å…¨æ€§**: å¤šå±‚å®‰å…¨é˜²æŠ¤
5. **å¯ç»´æŠ¤**: ä»£ç ç»“æ„æ¸…æ™°

è¿™ä¸ªæ¶æ„ä½¿å¾— LoongClaw æ—¢èƒ½ä½œä¸ºå­¦ä¹  AI Agent ç³»ç»Ÿçš„å…¥é—¨é¡¹ç›®ï¼Œä¹Ÿèƒ½ä½œä¸ºè½»é‡çº§ç”Ÿäº§ç¯å¢ƒçš„å‚è€ƒå®ç°ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026å¹´2æœˆ12æ—¥
**ç»´æŠ¤è€…**: ç†Šå¤§ ğŸ‰ğŸ’ª
